<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ÂÆ¢Êà∂ÁÆ°ÁêÜ</title>
  <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <div id="app">
    <div class="page-container">
      <!-- È†ÅÈù¢Ê®ôÈ°å -->
      <div class="page-header">
        <h2>üë§ ÂÆ¢Êà∂ÁÆ°ÁêÜ</h2>
        <p class="page-description">ÁÆ°ÁêÜÂÆ¢Êà∂Ë≥áÊñô„ÄÅÊü•ÁúãÁ∂≠‰øÆÊ≠∑Âè≤„ÄÅÁµ±Ë®àÂÆ¢Êà∂Êï∏Êìö</p>
      </div>

      <!-- Áµ±Ë®àÂç°Áâá -->
      <div class="stats-grid">
        <div class="stat-card primary">
          <div class="stat-icon">
            <i class="fa-solid fa-users"></i>
          </div>
          <div class="stat-info">
            <div class="stat-label">Á∏ΩÂÆ¢Êà∂Êï∏</div>
            <div class="stat-value">{{ customers.length }}</div>
          </div>
        </div>
        
        <div class="stat-card success">
          <div class="stat-icon">
            <i class="fa-solid fa-motorcycle"></i>
          </div>
          <div class="stat-info">
            <div class="stat-label">ÁôªË®òËªäËºõ</div>
            <div class="stat-value">{{ totalVehicles }}</div>
          </div>
        </div>
        
        <div class="stat-card warning">
          <div class="stat-icon">
            <i class="fa-solid fa-calendar-check"></i>
          </div>
          <div class="stat-info">
            <div class="stat-label">Êú¨ÊúàÊñ∞Â¢û</div>
            <div class="stat-value">{{ monthlyNewCustomers }}</div>
          </div>
        </div>
        
        <div class="stat-card info">
          <div class="stat-icon">
            <i class="fa-solid fa-star"></i>
          </div>
          <div class="stat-info">
            <div class="stat-label">VIPÂÆ¢Êà∂</div>
            <div class="stat-value">{{ vipCustomers }}</div>
          </div>
        </div>
      </div>

      <!-- ÊêúÂ∞ãÂíåÁØ©ÈÅ∏ -->
      <div class="card mb-20">
        <div class="card-body">
          <div class="search-bar">
            <el-input
              v-model="searchKeyword"
              placeholder="ÊêúÂ∞ãÂÆ¢Êà∂ÂßìÂêç„ÄÅÈõªË©±ÊàñËªäÁâå"
              clearable
              style="width: 300px;">
              <template #prefix>
                <i class="fa-solid fa-search"></i>
              </template>
            </el-input>
            
            <el-select 
              v-model="filterBrand" 
              placeholder="ËªäËºõÂìÅÁâå" 
              clearable
              style="width: 150px;">
              <el-option label="ÂÖ®ÈÉ®ÂìÅÁâå" value=""></el-option>
              <el-option 
                v-for="brand in brands" 
                :key="brand" 
                :label="brand" 
                :value="brand">
              </el-option>
            </el-select>

            <el-select 
              v-model="filterLevel" 
              placeholder="ÂÆ¢Êà∂Á≠âÁ¥ö" 
              clearable
              style="width: 150px;">
              <el-option label="ÂÖ®ÈÉ®Á≠âÁ¥ö" value=""></el-option>
              <el-option label="‰∏ÄËà¨ÂÆ¢Êà∂" value="normal"></el-option>
              <el-option label="VIPÂÆ¢Êà∂" value="vip"></el-option>
            </el-select>

            <div style="flex: 1;"></div>

            <el-button type="primary" @click="openAddDialog">
              <i class="fa-solid fa-user-plus"></i> Êñ∞Â¢ûÂÆ¢Êà∂
            </el-button>
            <el-button @click="exportCustomers">
              <i class="fa-solid fa-download"></i> ÂåØÂá∫Excel
            </el-button>
          </div>
        </div>
      </div>

      <!-- ÂÆ¢Êà∂Ë°®Ê†º -->
      <div class="card">
        <div class="card-body" style="padding: 0;">
          <el-table 
            :data="filteredCustomers" 
            border 
            stripe
            @row-click="viewCustomerDetail">
            <el-table-column type="expand">
              <template #default="props">
                <div style="padding: 20px;">
                  <h4 style="margin-bottom: 12px;">
                    <i class="fa-solid fa-circle-info"></i> Ë©≥Á¥∞Ë≥áÊñô
                  </h4>
                  <div class="detail-row">
                    <div class="detail-label">Âú∞ÂùÄ</div>
                    <div class="detail-value">{{ props.row.address || 'Êú™Â°´ÂØ´' }}</div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-label">Email</div>
                    <div class="detail-value">{{ props.row.email || 'Êú™Â°´ÂØ´' }}</div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-label">Ë®ªÂÜäÊó•Êúü</div>
                    <div class="detail-value">{{ props.row.registerDate }}</div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-label">Á∂≠‰øÆÊ¨°Êï∏</div>
                    <div class="detail-value">
                      <el-tag type="success">{{ props.row.repairCount }} Ê¨°</el-tag>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-label">Á¥ØË®àÊ∂àË≤ª</div>
                    <div class="detail-value">
                      <strong style="color: #67c23a; font-size: 16px;">
                        ${{ props.row.totalSpent.toLocaleString() }}
                      </strong>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-label">ÂÇôË®ª</div>
                    <div class="detail-value">{{ props.row.note || 'ÁÑ°' }}</div>
                  </div>
                </div>
              </template>
            </el-table-column>
            <el-table-column prop="name" label="ÂßìÂêç" width="120">
              <template #default="scope">
                <div style="display: flex; align-items: center; gap: 8px;">
                  <i class="fa-solid fa-user" style="color: #409EFF;"></i>
                  <strong>{{ scope.row.name }}</strong>
                </div>
              </template>
            </el-table-column>
            <el-table-column prop="phone" label="ÈõªË©±" width="140">
              <template #default="scope">
                <i class="fa-solid fa-phone" style="color: #67c23a; margin-right: 6px;"></i>
                {{ scope.row.phone }}
              </template>
            </el-table-column>
            <el-table-column prop="plate" label="ËªäÁâå" width="130">
              <template #default="scope">
                <el-tag>{{ scope.row.plate }}</el-tag>
              </template>
            </el-table-column>
            <el-table-column prop="model" label="ËªäÊ¨æ" width="180">
              <template #default="scope">
                <div style="display: flex; align-items: center; gap: 6px;">
                  <i class="fa-solid fa-motorcycle" style="color: #909399;"></i>
                  {{ scope.row.model }}
                </div>
              </template>
            </el-table-column>
            <el-table-column label="ÂÆ¢Êà∂Á≠âÁ¥ö" width="110" align="center">
              <template #default="scope">
                <el-tag :type="scope.row.level === 'vip' ? 'danger' : ''">
                  <i :class="scope.row.level === 'vip' ? 'fa-solid fa-crown' : 'fa-solid fa-user'"></i>
                  {{ scope.row.level === 'vip' ? 'VIP' : '‰∏ÄËà¨' }}
                </el-tag>
              </template>
            </el-table-column>
            <el-table-column prop="repairCount" label="Á∂≠‰øÆÊ¨°Êï∏" width="100" align="center" sortable>
              <template #default="scope">
                <el-tag type="success" size="small">{{ scope.row.repairCount }}</el-tag>
              </template>
            </el-table-column>
            <el-table-column prop="totalSpent" label="Á¥ØË®àÊ∂àË≤ª" width="130" align="right" sortable>
              <template #default="scope">
                <span style="color: #67c23a; font-weight: bold;">
                  ${{ scope.row.totalSpent.toLocaleString() }}
                </span>
              </template>
            </el-table-column>
            <el-table-column label="Êìç‰Ωú" width="220" align="center" fixed="right">
              <template #default="scope">
                <el-button 
                  size="small" 
                  @click.stop="viewHistory(scope.row)">
                  <i class="fa-solid fa-clock-rotate-left"></i> Ê≠∑Âè≤
                </el-button>
                <el-button 
                  size="small" 
                  @click.stop="editCustomer(scope.row)">
                  <i class="fa-solid fa-edit"></i>
                </el-button>
                <el-button 
                  size="small" 
                  type="danger" 
                  @click.stop="deleteCustomer(scope.row)">
                  <i class="fa-solid fa-trash"></i>
                </el-button>
              </template>
            </el-table-column>
          </el-table>
        </div>
      </div>
    </div>

    <!-- Êñ∞Â¢û/Á∑®ËºØÂÆ¢Êà∂Â∞çË©±Ê°Ü -->
    <el-dialog 
      v-model="showDialog" 
      :title="dialogTitle"
      width="600px">
      <el-form :model="form" label-width="100px">
        <el-form-item label="ÂßìÂêç" required>
          <el-input 
            v-model="form.name"
            placeholder="Ë´ãËº∏ÂÖ•ÂÆ¢Êà∂ÂßìÂêç">
            <template #prefix>
              <i class="fa-solid fa-user"></i>
            </template>
          </el-input>
        </el-form-item>
        <el-form-item label="ÈõªË©±" required>
          <el-input 
            v-model="form.phone"
            placeholder="0912-345-678">
            <template #prefix>
              <i class="fa-solid fa-phone"></i>
            </template>
          </el-input>
        </el-form-item>
        <el-form-item label="ËªäÁâåËôüÁ¢º" required>
          <el-input 
            v-model="form.plate"
            placeholder="ABC-1234">
            <template #prefix>
              <i class="fa-solid fa-id-card"></i>
            </template>
          </el-input>
        </el-form-item>
        <el-form-item label="ËªäÊ¨æ" required>
          <el-input 
            v-model="form.model"
            placeholder="‰æãÂ¶ÇÔºöYamaha SMAX">
            <template #prefix>
              <i class="fa-solid fa-motorcycle"></i>
            </template>
          </el-input>
        </el-form-item>
        <el-form-item label="Email">
          <el-input 
            v-model="form.email"
            placeholder="example@email.com">
            <template #prefix>
              <i class="fa-solid fa-envelope"></i>
            </template>
          </el-input>
        </el-form-item>
        <el-form-item label="Âú∞ÂùÄ">
          <el-input 
            v-model="form.address"
            placeholder="Ë´ãËº∏ÂÖ•Âú∞ÂùÄ">
            <template #prefix>
              <i class="fa-solid fa-location-dot"></i>
            </template>
          </el-input>
        </el-form-item>
        <el-form-item label="ÂÆ¢Êà∂Á≠âÁ¥ö">
          <el-radio-group v-model="form.level">
            <el-radio label="normal">
              <i class="fa-solid fa-user"></i> ‰∏ÄËà¨ÂÆ¢Êà∂
            </el-radio>
            <el-radio label="vip">
              <i class="fa-solid fa-crown"></i> VIPÂÆ¢Êà∂
            </el-radio>
          </el-radio-group>
        </el-form-item>
        <el-form-item label="ÂÇôË®ª">
          <el-input 
            v-model="form.note"
            type="textarea"
            :rows="3"
            placeholder="ÂÖ∂‰ªñÈúÄË¶ÅË®òÈåÑÁöÑË≥áË®ä">
          </el-input>
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="showDialog = false">ÂèñÊ∂à</el-button>
        <el-button type="primary" @click="saveCustomer">
          <i class="fa-solid fa-check"></i> Á¢∫Ë™çÂÑ≤Â≠ò
        </el-button>
      </template>
    </el-dialog>

    <!-- Á∂≠‰øÆÊ≠∑Âè≤Â∞çË©±Ê°Ü -->
    <el-dialog 
      v-model="showHistoryDialog" 
      :title="historyTitle"
      width="800px">
      <div class="timeline">
        <div class="timeline-item" v-for="record in historyRecords" :key="record.id">
          <div class="timeline-dot"></div>
          <div class="timeline-content">
            <div class="timeline-title">{{ record.item }}</div>
            <div class="timeline-time">{{ record.date }}</div>
            <div class="timeline-desc">
              <div style="display: flex; gap: 20px; margin-top: 8px;">
                <span>
                  <i class="fa-solid fa-wrench"></i>
                  Á∂≠‰øÆÈ†ÖÁõÆÔºö{{ record.item }}
                </span>
                <span>
                  <i class="fa-solid fa-dollar-sign"></i>
                  Ë≤ªÁî®Ôºö${{ record.cost.toLocaleString() }}
                </span>
                <span>
                  <el-tag :type="getStatusType(record.status)" size="small">
                    {{ record.status }}
                  </el-tag>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div v-if="historyRecords.length === 0" class="empty-state">
        <i class="fa-solid fa-clipboard"></i>
        <p>Â∞öÁÑ°Á∂≠‰øÆË®òÈåÑ</p>
      </div>
    </el-dialog>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/element-plus"></script>
  <script>
    const { createApp, ref, computed } = Vue

    createApp({
      setup() {
        const customers = ref([
          { 
            id: 1, 
            name: 'ÁéãÂ∞èÊòé', 
            phone: '0912-345-678', 
            plate: 'ABC-1234', 
            model: 'Yamaha SMAX',
            email: 'wang@example.com',
            address: 'Âè∞ÂåóÂ∏Ç‰ø°Áæ©ÂçÄ‰ø°Áæ©Ë∑Ø100Ëôü',
            level: 'vip',
            registerDate: '2024/05/15',
            repairCount: 8,
            totalSpent: 12500,
            note: 'Â∏∏ÂÆ¢ÔºåÂñúÊ≠°ÂéüÂª†Èõ∂‰ª∂'
          },
          { 
            id: 2, 
            name: 'ÊùéÂ§ßËèØ', 
            phone: '0987-654-321', 
            plate: 'DEF-5678', 
            model: 'SYM Jet S',
            email: 'lee@example.com',
            address: 'Êñ∞ÂåóÂ∏ÇÊùøÊ©ãÂçÄÊñáÂåñË∑Ø200Ëôü',
            level: 'normal',
            registerDate: '2024/08/20',
            repairCount: 3,
            totalSpent: 4200,
            note: ''
          },
          { 
            id: 3, 
            name: 'Èô≥Â∞èÁæé', 
            phone: '0923-456-789', 
            plate: 'XYZ-9999', 
            model: 'Gogoro 2',
            email: 'chen@example.com',
            address: 'Ê°ÉÂúíÂ∏Ç‰∏≠Â£¢ÂçÄ‰∏≠Â±±Ë∑Ø300Ëôü',
            level: 'vip',
            registerDate: '2023/12/10',
            repairCount: 15,
            totalSpent: 28900,
            note: 'VIPÂÆ¢Êà∂ÔºåÂÆöÊúü‰øùÈ§ä'
          },
          { 
            id: 4, 
            name: 'Âºµ‰∏â', 
            phone: '0934-567-890', 
            plate: 'GHI-1111', 
            model: 'Kymco Racing 150',
            email: '',
            address: '',
            level: 'normal',
            registerDate: '2025/09/05',
            repairCount: 1,
            totalSpent: 800,
            note: ''
          },
        ])

        const searchKeyword = ref('')
        const filterBrand = ref('')
        const filterLevel = ref('')
        const showDialog = ref(false)
        const showHistoryDialog = ref(false)
        const isEdit = ref(false)
        const currentCustomer = ref(null)
        
        const form = ref({ 
          id: null, 
          name: '', 
          phone: '', 
          plate: '', 
          model: '',
          email: '',
          address: '',
          level: 'normal',
          registerDate: '',
          repairCount: 0,
          totalSpent: 0,
          note: ''
        })

        const historyRecords = ref([
          { id: 1, date: '2025/10/15', item: 'ÊèõÊ©üÊ≤π', cost: 500, status: 'Â∑≤ÂÆåÊàê' },
          { id: 2, date: '2025/09/20', item: 'Êõ¥ÊèõÁÖûËªäÁöÆ', cost: 800, status: 'Â∑≤ÂÆåÊàê' },
          { id: 3, date: '2025/08/10', item: 'ÂÆöÊúü‰øùÈ§ä', cost: 1200, status: 'Â∑≤ÂÆåÊàê' },
        ])

        // ÂìÅÁâåÂàóË°®
        const brands = computed(() => {
          const brandSet = new Set()
          customers.value.forEach(c => {
            const brand = c.model.split(' ')[0]
            brandSet.add(brand)
          })
          return Array.from(brandSet)
        })

        // Á∏ΩËªäËºõÊï∏
        const totalVehicles = computed(() => {
          return customers.value.length
        })

        // Êú¨ÊúàÊñ∞Â¢ûÂÆ¢Êà∂
        const monthlyNewCustomers = computed(() => {
          const today = new Date()
          const currentMonth = today.getMonth() + 1
          const currentYear = today.getFullYear()
          
          return customers.value.filter(c => {
            const [year, month] = c.registerDate.split('/')
            return parseInt(year) === currentYear && parseInt(month) === currentMonth
          }).length
        })

        // VIPÂÆ¢Êà∂Êï∏
        const vipCustomers = computed(() => {
          return customers.value.filter(c => c.level === 'vip').length
        })

        // ÁØ©ÈÅ∏ÂæåÁöÑÂÆ¢Êà∂
        const filteredCustomers = computed(() => {
          let result = customers.value

          // ÈóúÈçµÂ≠óÊêúÂ∞ã
          const kw = searchKeyword.value.trim()
          if (kw) {
            result = result.filter(c =>
              c.name.includes(kw) || 
              c.plate.includes(kw) ||
              c.phone.includes(kw)
            )
          }

          // ÂìÅÁâåÁØ©ÈÅ∏
          if (filterBrand.value) {
            result = result.filter(c => c.model.startsWith(filterBrand.value))
          }

          // Á≠âÁ¥öÁØ©ÈÅ∏
          if (filterLevel.value) {
            result = result.filter(c => c.level === filterLevel.value)
          }

          return result
        })

        // Â∞çË©±Ê°ÜÊ®ôÈ°å
        const dialogTitle = computed(() => {
          return isEdit.value ? 'Á∑®ËºØÂÆ¢Êà∂Ë≥áÊñô' : 'Êñ∞Â¢ûÂÆ¢Êà∂'
        })

        // Ê≠∑Âè≤Ë®òÈåÑÊ®ôÈ°å
        const historyTitle = computed(() => {
          return currentCustomer.value 
            ? `${currentCustomer.value.name} ÁöÑÁ∂≠‰øÆÊ≠∑Âè≤` 
            : 'Á∂≠‰øÆÊ≠∑Âè≤'
        })

        // ÂèñÂæóÁãÄÊÖãÈ°ûÂûã
        const getStatusType = (status) => {
          const types = {
            'Â∑≤ÂÆåÊàê': 'success',
            'ÈÄ≤Ë°å‰∏≠': 'warning',
            'ÂæÖËôïÁêÜ': 'info'
          }
          return types[status] || ''
        }

        // ÊâìÈñãÊñ∞Â¢ûÂ∞çË©±Ê°Ü
        const openAddDialog = () => {
          isEdit.value = false
          const today = new Date()
          form.value = { 
            id: null, 
            name: '', 
            phone: '', 
            plate: '', 
            model: '',
            email: '',
            address: '',
            level: 'normal',
            registerDate: `${today.getFullYear()}/${String(today.getMonth() + 1).padStart(2, '0')}/${String(today.getDate()).padStart(2, '0')}`,
            repairCount: 0,
            totalSpent: 0,
            note: ''
          }
          showDialog.value = true
        }

        // Á∑®ËºØÂÆ¢Êà∂
        const editCustomer = (row) => {
          isEdit.value = true
          form.value = { ...row }
          showDialog.value = true
        }

        // ÂÑ≤Â≠òÂÆ¢Êà∂
        const saveCustomer = () => {
          if (!form.value.name || !form.value.phone || !form.value.plate || !form.value.model) {
            ElementPlus.ElMessage.warning('Ë´ãÂ°´ÂØ´ÂøÖÂ°´Ê¨Ñ‰Ωç')
            return
          }

          if (isEdit.value) {
            const index = customers.value.findIndex(c => c.id === form.value.id)
            if (index !== -1) {
              customers.value[index] = { ...form.value }
              ElementPlus.ElMessage.success('Êõ¥Êñ∞ÊàêÂäü')
            }
          } else {
            const newId = customers.value.length > 0
              ? Math.max(...customers.value.map(c => c.id)) + 1
              : 1
            form.value.id = newId
            customers.value.push({ ...form.value })
            ElementPlus.ElMessage.success('Êñ∞Â¢ûÊàêÂäü')
          }
          showDialog.value = false
        }

        // Âà™Èô§ÂÆ¢Êà∂
        const deleteCustomer = (row) => {
          ElementPlus.ElMessageBox.confirm(
            `Á¢∫ÂÆöË¶ÅÂà™Èô§„Äå${row.name}„ÄçÁöÑË≥áÊñôÂóéÔºüÁõ∏ÈóúÁöÑÁ∂≠‰øÆË®òÈåÑ‰πüÊúÉË¢´Âà™Èô§„ÄÇ`,
            'Á¢∫Ë™çÂà™Èô§',
            { 
              confirmButtonText: 'Á¢∫ÂÆö',
              cancelButtonText: 'ÂèñÊ∂à',
              type: 'warning' 
            }
          ).then(() => {
            customers.value = customers.value.filter(c => c.id !== row.id)
            ElementPlus.ElMessage.success('Â∑≤Âà™Èô§')
          }).catch(() => {})
        }

        // Êü•ÁúãÁ∂≠‰øÆÊ≠∑Âè≤
        const viewHistory = (row) => {
          currentCustomer.value = row
          // ÈÄôË£°ÂèØ‰ª•Ê†πÊìöÂÆ¢Êà∂IDËºâÂÖ•ÁúüÂØ¶ÁöÑÊ≠∑Âè≤Ë®òÈåÑ
          showHistoryDialog.value = true
        }

        // Êü•ÁúãÂÆ¢Êà∂Ë©≥ÊÉÖÔºàÈªûÊìäË°åÔºâ
        const viewCustomerDetail = (row) => {
          // Â±ïÈñãË°åÁöÑÂäüËÉΩÁî± Element Plus Ëá™ÂãïËôïÁêÜ
          console.log('Êü•ÁúãÂÆ¢Êà∂Ë©≥ÊÉÖ:', row.name)
        }

        // ÂåØÂá∫ÂÆ¢Êà∂
        const exportCustomers = () => {
          ElementPlus.ElMessage.info('ÂåØÂá∫ÂäüËÉΩÈñãÁôº‰∏≠')
        }

        return {
          customers,
          filteredCustomers,
          searchKeyword,
          filterBrand,
          filterLevel,
          brands,
          totalVehicles,
          monthlyNewCustomers,
          vipCustomers,
          showDialog,
          showHistoryDialog,
          form,
          isEdit,
          currentCustomer,
          historyRecords,
          dialogTitle,
          historyTitle,
          getStatusType,
          openAddDialog,
          editCustomer,
          saveCustomer,
          deleteCustomer,
          viewHistory,
          viewCustomerDetail,
          exportCustomers
        }
      }
    }).use(ElementPlus).mount('#app')
  </script>
</body>
</html>