<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å„ªæƒ ç®¡ç†</title>
  <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <div id="app">
    <div class="page-container">
      <!-- é é¢æ¨™é¡Œ -->
      <div class="page-header">
        <h2>ğŸŸï¸ å„ªæƒ ç®¡ç†</h2>
        <p class="page-description">è¨­å®šå„ªæƒ æ–¹æ¡ˆã€ç®¡ç†ä¿ƒéŠ·æ´»å‹•ã€è¿½è¹¤ä½¿ç”¨æƒ…æ³</p>
      </div>

      <!-- çµ±è¨ˆå¡ç‰‡ -->
      <div class="stats-grid">
        <div class="stat-card primary">
          <div class="stat-icon">
            <i class="fa-solid fa-ticket"></i>
          </div>
          <div class="stat-info">
            <div class="stat-label">å„ªæƒ æ–¹æ¡ˆæ•¸</div>
            <div class="stat-value">{{ discounts.length }}</div>
          </div>
        </div>
        
        <div class="stat-card success">
          <div class="stat-icon">
            <i class="fa-solid fa-check-circle"></i>
          </div>
          <div class="stat-info">
            <div class="stat-label">é€²è¡Œä¸­</div>
            <div class="stat-value">{{ activeDiscounts }}</div>
          </div>
        </div>
        
        <div class="stat-card warning">
          <div class="stat-icon">
            <i class="fa-solid fa-users"></i>
          </div>
          <div class="stat-info">
            <div class="stat-label">ç¸½ä½¿ç”¨æ¬¡æ•¸</div>
            <div class="stat-value">{{ totalUsage }}</div>
          </div>
        </div>
        
        <div class="stat-card info">
          <div class="stat-icon">
            <i class="fa-solid fa-clock"></i>
          </div>
          <div class="stat-info">
            <div class="stat-label">å³å°‡åˆ°æœŸ</div>
            <div class="stat-value">{{ expiringSoon }}</div>
          </div>
        </div>
      </div>

      <!-- æ–°å¢å„ªæƒ è¡¨å–® -->
      <div class="card mb-20">
        <div class="card-header">
          <i class="fa-solid fa-plus-circle"></i> æ–°å¢å„ªæƒ æ–¹æ¡ˆ
        </div>
        <div class="card-body">
          <el-form :inline="true">
            <el-form-item label="å„ªæƒ åç¨±">
              <el-input 
                v-model="newDiscount.name" 
                placeholder="ä¾‹å¦‚ï¼šæ»¿1000æŠ˜100"
                style="width: 200px;">
              </el-input>
            </el-form-item>
            <el-form-item label="å„ªæƒ é¡å‹">
              <el-select 
                v-model="newDiscount.type" 
                placeholder="é¸æ“‡é¡å‹"
                style="width: 150px;">
                <el-option label="æŠ˜æ‰£" value="discount"></el-option>
                <el-option label="æ»¿é¡æŠ˜" value="amount_off"></el-option>
                <el-option label="æŠ˜æ‰£ç¢¼" value="code"></el-option>
                <el-option label="æœƒå“¡å°ˆå±¬" value="member"></el-option>
              </el-select>
            </el-form-item>
            <el-form-item label="æŠ˜æ‰£å…§å®¹">
              <el-input 
                v-model="newDiscount.content" 
                placeholder="ä¾‹å¦‚ï¼š9æŠ˜ æˆ– æŠ˜100å…ƒ"
                style="width: 150px;">
              </el-input>
            </el-form-item>
            <el-form-item label="æ´»å‹•æœŸé–“">
              <el-date-picker
                v-model="newDiscount.dateRange"
                type="daterange"
                range-separator="è‡³"
                start-placeholder="é–‹å§‹æ—¥æœŸ"
                end-placeholder="çµæŸæ—¥æœŸ"
                value-format="YYYY/MM/DD"
                style="width: 280px;">
              </el-date-picker>
            </el-form-item>
            <el-form-item>
              <el-button type="primary" @click="addDiscount">
                <i class="fa-solid fa-plus"></i> æ–°å¢å„ªæƒ 
              </el-button>
            </el-form-item>
          </el-form>
        </div>
      </div>

      <!-- å¿«é€Ÿç¯©é¸ -->
      <div class="card mb-20">
        <div class="card-body">
          <div class="search-bar">
            <el-input
              v-model="searchKeyword"
              placeholder="æœå°‹å„ªæƒ åç¨±..."
              clearable
              style="width: 250px;">
              <template #prefix>
                <i class="fa-solid fa-search"></i>
              </template>
            </el-input>
            
            <el-select 
              v-model="filterType" 
              placeholder="å…¨éƒ¨é¡å‹" 
              clearable
              style="width: 150px;">
              <el-option label="å…¨éƒ¨é¡å‹" value=""></el-option>
              <el-option label="æŠ˜æ‰£" value="discount"></el-option>
              <el-option label="æ»¿é¡æŠ˜" value="amount_off"></el-option>
              <el-option label="æŠ˜æ‰£ç¢¼" value="code"></el-option>
              <el-option label="æœƒå“¡å°ˆå±¬" value="member"></el-option>
            </el-select>

            <el-select 
              v-model="filterStatus" 
              placeholder="å…¨éƒ¨ç‹€æ…‹" 
              clearable
              style="width: 150px;">
              <el-option label="å…¨éƒ¨ç‹€æ…‹" value=""></el-option>
              <el-option label="é€²è¡Œä¸­" value="active"></el-option>
              <el-option label="å³å°‡é–‹å§‹" value="upcoming"></el-option>
              <el-option label="å·²çµæŸ" value="expired"></el-option>
            </el-select>
          </div>
        </div>
      </div>

      <!-- å„ªæƒ åˆ—è¡¨ -->
      <div class="discount-grid">
        <div 
          class="discount-card" 
          v-for="(discount, index) in filteredDiscounts" 
          :key="discount.id">
          <!-- å¡ç‰‡é ­éƒ¨ -->
          <div class="discount-header" :class="getStatusClass(discount)">
            <div class="discount-badge">
              <i :class="getTypeIcon(discount.type)"></i>
            </div>
            <div class="discount-status">
              <el-tag :type="getStatusTagType(discount)" size="small">
                {{ getStatusText(discount) }}
              </el-tag>
            </div>
          </div>

          <!-- å¡ç‰‡å…§å®¹ -->
          <div class="discount-body">
            <div class="discount-title">{{ discount.name }}</div>
            <div class="discount-content">
              <i class="fa-solid fa-tag"></i>
              {{ discount.content }}
            </div>
            <div class="discount-type">
              <el-tag :type="getTypeTagType(discount.type)" size="small">
                {{ getTypeText(discount.type) }}
              </el-tag>
            </div>

            <div class="discount-info">
              <div class="info-item">
                <i class="fa-solid fa-calendar"></i>
                <span>{{ discount.startDate }} ~ {{ discount.endDate }}</span>
              </div>
              <div class="info-item">
                <i class="fa-solid fa-users"></i>
                <span>å·²ä½¿ç”¨ <strong>{{ discount.usage }}</strong> æ¬¡</span>
              </div>
              <div class="info-item">
                <i class="fa-solid fa-clock"></i>
                <span>å‰©é¤˜ <strong>{{ getDaysLeft(discount) }}</strong> å¤©</span>
              </div>
            </div>
          </div>

          <!-- å¡ç‰‡æ“ä½œ -->
          <div class="discount-footer">
            <el-button size="small" @click="editDiscount(discount)">
              <i class="fa-solid fa-edit"></i> ç·¨è¼¯
            </el-button>
            <el-button size="small" @click="duplicateDiscount(discount)">
              <i class="fa-solid fa-copy"></i> è¤‡è£½
            </el-button>
            <el-button size="small" type="danger" @click="removeDiscount(index)">
              <i class="fa-solid fa-trash"></i> åˆªé™¤
            </el-button>
          </div>
        </div>
      </div>

      <!-- ç©ºç‹€æ…‹ -->
      <div v-if="filteredDiscounts.length === 0" class="empty-state">
        <i class="fa-solid fa-ticket"></i>
        <h3>å°šç„¡å„ªæƒ æ–¹æ¡ˆ</h3>
        <p>è«‹ä½¿ç”¨ä¸Šæ–¹è¡¨å–®æ–°å¢ç¬¬ä¸€å€‹å„ªæƒ æ–¹æ¡ˆ</p>
      </div>
    </div>

    <!-- ç·¨è¼¯å„ªæƒ å°è©±æ¡† -->
    <el-dialog 
      v-model="showEditDialog" 
      title="ç·¨è¼¯å„ªæƒ æ–¹æ¡ˆ"
      width="500px">
      <el-form :model="editForm" label-width="90px">
        <el-form-item label="å„ªæƒ åç¨±" required>
          <el-input 
            v-model="editForm.name"
            placeholder="è«‹è¼¸å…¥å„ªæƒ åç¨±">
          </el-input>
        </el-form-item>
        <el-form-item label="å„ªæƒ é¡å‹" required>
          <el-select 
            v-model="editForm.type" 
            style="width: 100%;">
            <el-option label="æŠ˜æ‰£" value="discount"></el-option>
            <el-option label="æ»¿é¡æŠ˜" value="amount_off"></el-option>
            <el-option label="æŠ˜æ‰£ç¢¼" value="code"></el-option>
            <el-option label="æœƒå“¡å°ˆå±¬" value="member"></el-option>
          </el-select>
        </el-form-item>
        <el-form-item label="æŠ˜æ‰£å…§å®¹" required>
          <el-input 
            v-model="editForm.content"
            placeholder="ä¾‹å¦‚ï¼š9æŠ˜ æˆ– æŠ˜100å…ƒ">
          </el-input>
        </el-form-item>
        <el-form-item label="æ´»å‹•æœŸé–“" required>
          <el-date-picker
            v-model="editForm.dateRange"
            type="daterange"
            range-separator="è‡³"
            start-placeholder="é–‹å§‹æ—¥æœŸ"
            end-placeholder="çµæŸæ—¥æœŸ"
            value-format="YYYY/MM/DD"
            style="width: 100%;">
          </el-date-picker>
        </el-form-item>
        <el-form-item label="ä½¿ç”¨æ¬¡æ•¸">
          <el-input-number 
            v-model="editForm.usage" 
            :min="0"
            style="width: 100%;">
          </el-input-number>
        </el-form-item>
        <el-form-item label="å‚™è¨»">
          <el-input 
            v-model="editForm.note"
            type="textarea"
            :rows="2"
            placeholder="å…¶ä»–èªªæ˜ï¼ˆé¸å¡«ï¼‰">
          </el-input>
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="showEditDialog = false">å–æ¶ˆ</el-button>
        <el-button type="primary" @click="saveEdit">
          <i class="fa-solid fa-check"></i> ç¢ºèªå„²å­˜
        </el-button>
      </template>
    </el-dialog>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/element-plus"></script>
  <script>
    const { createApp, ref, computed } = Vue

    createApp({
      setup() {
        const discounts = ref([
          { 
            id: 1, 
            name: 'æ»¿1000æŠ˜100', 
            type: 'amount_off',
            content: 'æ»¿1000æŠ˜100å…ƒ',
            startDate: '2025/10/01',
            endDate: '2025/10/31',
            usage: 12,
            note: ''
          },
          { 
            id: 2, 
            name: 'ä¿é¤Š9æŠ˜å„ªæƒ ', 
            type: 'discount',
            content: 'æ‰€æœ‰ä¿é¤Šé …ç›®9æŠ˜',
            startDate: '2025/11/01',
            endDate: '2025/11/30',
            usage: 5,
            note: ''
          },
          { 
            id: 3, 
            name: 'æœƒå“¡å°ˆå±¬85æŠ˜', 
            type: 'member',
            content: 'æœƒå“¡å°ˆå±¬85æŠ˜',
            startDate: '2025/10/15',
            endDate: '2025/12/31',
            usage: 28,
            note: 'åƒ…é™VIPæœƒå“¡'
          },
          { 
            id: 4, 
            name: 'æ–°å®¢é¦–æ¬¡æ¶ˆè²»æŠ˜200', 
            type: 'code',
            content: 'æŠ˜æ‰£ç¢¼ï¼šNEW200',
            startDate: '2025/09/01',
            endDate: '2025/10/20',
            usage: 45,
            note: 'å·²çµæŸ'
          },
        ])

        const searchKeyword = ref('')
        const filterType = ref('')
        const filterStatus = ref('')
        const showEditDialog = ref(false)
        
        const newDiscount = ref({
          name: '',
          type: 'discount',
          content: '',
          dateRange: [],
          usage: 0
        })

        const editForm = ref({
          id: null,
          name: '',
          type: 'discount',
          content: '',
          dateRange: [],
          usage: 0,
          note: ''
        })

        // é€²è¡Œä¸­çš„å„ªæƒ 
        const activeDiscounts = computed(() => {
          const today = new Date()
          return discounts.value.filter(d => {
            const start = new Date(d.startDate)
            const end = new Date(d.endDate)
            return today >= start && today <= end
          }).length
        })

        // ç¸½ä½¿ç”¨æ¬¡æ•¸
        const totalUsage = computed(() => {
          return discounts.value.reduce((sum, d) => sum + d.usage, 0)
        })

        // å³å°‡åˆ°æœŸ
        const expiringSoon = computed(() => {
          const today = new Date()
          const sevenDaysLater = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000)
          return discounts.value.filter(d => {
            const end = new Date(d.endDate)
            return end > today && end <= sevenDaysLater
          }).length
        })

        // ç¯©é¸å¾Œçš„å„ªæƒ 
        const filteredDiscounts = computed(() => {
          let result = discounts.value

          // é—œéµå­—æœå°‹
          if (searchKeyword.value) {
            result = result.filter(d => 
              d.name.includes(searchKeyword.value) || 
              d.content.includes(searchKeyword.value)
            )
          }

          // é¡å‹ç¯©é¸
          if (filterType.value) {
            result = result.filter(d => d.type === filterType.value)
          }

          // ç‹€æ…‹ç¯©é¸
          if (filterStatus.value) {
            const today = new Date()
            result = result.filter(d => {
              const start = new Date(d.startDate)
              const end = new Date(d.endDate)
              
              if (filterStatus.value === 'active') {
                return today >= start && today <= end
              } else if (filterStatus.value === 'upcoming') {
                return today < start
              } else if (filterStatus.value === 'expired') {
                return today > end
              }
              return true
            })
          }

          return result
        })

        // å–å¾—ç‹€æ…‹é¡åˆ¥
        const getStatusClass = (discount) => {
          const today = new Date()
          const start = new Date(discount.startDate)
          const end = new Date(discount.endDate)
          
          if (today < start) return 'upcoming'
          if (today > end) return 'expired'
          return 'active'
        }

        // å–å¾—ç‹€æ…‹æ¨™ç±¤é¡å‹
        const getStatusTagType = (discount) => {
          const status = getStatusClass(discount)
          const types = {
            'active': 'success',
            'upcoming': 'warning',
            'expired': 'info'
          }
          return types[status]
        }

        // å–å¾—ç‹€æ…‹æ–‡å­—
        const getStatusText = (discount) => {
          const status = getStatusClass(discount)
          const texts = {
            'active': 'é€²è¡Œä¸­',
            'upcoming': 'å³å°‡é–‹å§‹',
            'expired': 'å·²çµæŸ'
          }
          return texts[status]
        }

        // å–å¾—é¡å‹åœ–ç¤º
        const getTypeIcon = (type) => {
          const icons = {
            'discount': 'fa-solid fa-percent',
            'amount_off': 'fa-solid fa-dollar-sign',
            'code': 'fa-solid fa-code',
            'member': 'fa-solid fa-crown'
          }
          return icons[type] || 'fa-solid fa-tag'
        }

        // å–å¾—é¡å‹æ¨™ç±¤é¡å‹
        const getTypeTagType = (type) => {
          const types = {
            'discount': 'primary',
            'amount_off': 'success',
            'code': 'warning',
            'member': 'danger'
          }
          return types[type] || ''
        }

        // å–å¾—é¡å‹æ–‡å­—
        const getTypeText = (type) => {
          const texts = {
            'discount': 'æŠ˜æ‰£',
            'amount_off': 'æ»¿é¡æŠ˜',
            'code': 'æŠ˜æ‰£ç¢¼',
            'member': 'æœƒå“¡å°ˆå±¬'
          }
          return texts[type] || 'ä¸€èˆ¬'
        }

        // å–å¾—å‰©é¤˜å¤©æ•¸
        const getDaysLeft = (discount) => {
          const today = new Date()
          const end = new Date(discount.endDate)
          const diff = Math.ceil((end - today) / (1000 * 60 * 60 * 24))
          return diff > 0 ? diff : 0
        }

        // æ–°å¢å„ªæƒ 
        const addDiscount = () => {
          if (!newDiscount.value.name || !newDiscount.value.content || !newDiscount.value.dateRange || newDiscount.value.dateRange.length !== 2) {
            ElementPlus.ElMessage.warning('è«‹å¡«å¯«å®Œæ•´è³‡æ–™')
            return
          }

          const newId = discounts.value.length > 0
            ? Math.max(...discounts.value.map(d => d.id)) + 1
            : 1

          discounts.value.push({
            id: newId,
            name: newDiscount.value.name,
            type: newDiscount.value.type,
            content: newDiscount.value.content,
            startDate: newDiscount.value.dateRange[0],
            endDate: newDiscount.value.dateRange[1],
            usage: 0,
            note: ''
          })

          newDiscount.value = {
            name: '',
            type: 'discount',
            content: '',
            dateRange: [],
            usage: 0
          }

          ElementPlus.ElMessage.success('æ–°å¢æˆåŠŸ')
        }

        // ç·¨è¼¯å„ªæƒ 
        const editDiscount = (discount) => {
          editForm.value = {
            ...discount,
            dateRange: [discount.startDate, discount.endDate]
          }
          showEditDialog.value = true
        }

        // å„²å­˜ç·¨è¼¯
        const saveEdit = () => {
          if (!editForm.value.name || !editForm.value.content || !editForm.value.dateRange || editForm.value.dateRange.length !== 2) {
            ElementPlus.ElMessage.warning('è«‹å¡«å¯«å®Œæ•´è³‡æ–™')
            return
          }

          const index = discounts.value.findIndex(d => d.id === editForm.value.id)
          if (index !== -1) {
            discounts.value[index] = {
              ...editForm.value,
              startDate: editForm.value.dateRange[0],
              endDate: editForm.value.dateRange[1]
            }
            ElementPlus.ElMessage.success('æ›´æ–°æˆåŠŸ')
            showEditDialog.value = false
          }
        }

        // è¤‡è£½å„ªæƒ 
        const duplicateDiscount = (discount) => {
          const newId = Math.max(...discounts.value.map(d => d.id)) + 1
          discounts.value.push({
            ...discount,
            id: newId,
            name: discount.name + ' (è¤‡è£½)',
            usage: 0
          })
          ElementPlus.ElMessage.success('è¤‡è£½æˆåŠŸ')
        }

        // åˆªé™¤å„ªæƒ 
        const removeDiscount = (index) => {
          ElementPlus.ElMessageBox.confirm(
            `ç¢ºå®šè¦åˆªé™¤ã€Œ${discounts.value[index].name}ã€å—ï¼Ÿ`,
            'ç¢ºèªåˆªé™¤',
            {
              confirmButtonText: 'ç¢ºå®š',
              cancelButtonText: 'å–æ¶ˆ',
              type: 'warning',
            }
          ).then(() => {
            discounts.value.splice(index, 1)
            ElementPlus.ElMessage.success('å·²åˆªé™¤')
          }).catch(() => {})
        }

        return {
          discounts,
          filteredDiscounts,
          searchKeyword,
          filterType,
          filterStatus,
          activeDiscounts,
          totalUsage,
          expiringSoon,
          newDiscount,
          editForm,
          showEditDialog,
          getStatusClass,
          getStatusTagType,
          getStatusText,
          getTypeIcon,
          getTypeTagType,
          getTypeText,
          getDaysLeft,
          addDiscount,
          editDiscount,
          saveEdit,
          duplicateDiscount,
          removeDiscount
        }
      }
    }).use(ElementPlus).mount('#app')
  </script>

  <style>
/* å„ªæƒ å¡ç‰‡ç¶²æ ¼ */
.discount-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

/* å„ªæƒ å¡ç‰‡ */
.discount-card {
  background: white;
  border: 1px solid #e4e7ed;
  border-radius: 8px;
  overflow: hidden;
  transition: all 0.3s;
}

.discount-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transform: translateY(-4px);
}

/* å¡ç‰‡é ­éƒ¨ */
.discount-header {
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  position: relative;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.discount-header.active {
  background: linear-gradient(135deg, #67c23a 0%, #85ce61 100%);
}

.discount-header.upcoming {
  background: linear-gradient(135deg, #e6a23c 0%, #f0c78a 100%);
}

.discount-header.expired {
  background: linear-gradient(135deg, #909399 0%, #c0c4cc 100%);
}

.discount-badge {
  width: 60px;
  height: 60px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 28px;
}

.discount-status {
  position: absolute;
  top: 12px;
  right: 12px;
}

/* å¡ç‰‡å…§å®¹ */
.discount-body {
  padding: 20px;
}

.discount-title {
  font-size: 18px;
  font-weight: 600;
  color: #303133;
  margin-bottom: 12px;
}

.discount-content {
  font-size: 24px;
  font-weight: bold;
  color: #409EFF;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.discount-type {
  margin-bottom: 16px;
}

.discount-info {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding-top: 12px;
  border-top: 1px solid #e4e7ed;
}

.info-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: #606266;
}

.info-item i {
  color: #909399;
  width: 16px;
}

.info-item strong {
  color: #409EFF;
}

/* å¡ç‰‡åº•éƒ¨ */
.discount-footer {
  padding: 12px 20px;
  background: #f5f7fa;
  border-top: 1px solid #e4e7ed;
  display: flex;
  gap: 8px;
  justify-content: space-between;
}

.discount-footer .el-button {
  flex: 1;
}

/* éŸ¿æ‡‰å¼ */
@media (max-width: 768px) {
  .discount-grid {
    grid-template-columns: 1fr;
  }

  .discount-footer {
    flex-direction: column;
  }

  .discount-footer .el-button {
    width: 100%;
  }
}
  </style>
</body>
</html>