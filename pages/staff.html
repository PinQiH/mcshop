<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>å“¡å·¥ç®¡ç†</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="../style.css">
</head>
<body>
<div id="app">
  <div class="page-container">
    <!-- é é¢æ¨™é¡Œ -->
    <div class="page-header">
      <h2>ğŸ‘¨â€ğŸ”§ å“¡å·¥ç®¡ç†</h2>
      <p class="page-description">ç®¡ç†å“¡å·¥è³‡æ–™ã€è¨˜éŒ„å·¥ä½œè¡¨ç¾ã€è¿½è¹¤æ¯ä½å“¡å·¥çš„ç¶­ä¿®ä»»å‹™å®Œæˆæƒ…æ³</p>
    </div>

    <!-- çµ±è¨ˆå¡ç‰‡ -->
    <div class="stats-grid">
      <div class="stat-card primary">
        <div class="stat-icon">
          <i class="fa-solid fa-users"></i>
        </div>
        <div class="stat-info">
          <div class="stat-label">å“¡å·¥ç¸½æ•¸</div>
          <div class="stat-value">{{ staffData.length }}</div>
        </div>
      </div>
      
      <div class="stat-card success">
        <div class="stat-icon">
          <i class="fa-solid fa-check-circle"></i>
        </div>
        <div class="stat-info">
          <div class="stat-label">ç¸½å®Œæˆä»»å‹™</div>
          <div class="stat-value">{{ totalTasks }}</div>
        </div>
      </div>
      
      <div class="stat-card warning">
        <div class="stat-icon">
          <i class="fa-solid fa-sack-dollar"></i>
        </div>
        <div class="stat-info">
          <div class="stat-label">æœ¬æœŸç¸½è–ªè³‡</div>
          <div class="stat-value">{{ totalSalary.toLocaleString() }}</div>
        </div>
      </div>
      
      <div class="stat-card info">
        <div class="stat-icon">
          <i class="fa-solid fa-star"></i>
        </div>
        <div class="stat-info">
          <div class="stat-label">æœ¬æœˆæœ€ä½³</div>
          <div class="stat-value">{{ topPerformer }}</div>
        </div>
      </div>
    </div>

    <!-- å¿«é€Ÿæ–°å¢å“¡å·¥ -->
    <div class="card mb-20">
      <div class="card-header">
        <i class="fa-solid fa-user-plus"></i> æ–°å¢å“¡å·¥
      </div>
      <div class="card-body">
        <el-form :inline="true" @submit.prevent="addStaff">
          <el-form-item label="å“¡å·¥å§“å">
            <el-input 
              v-model="newStaffName" 
              placeholder="è«‹è¼¸å…¥å§“å"
              style="width: 200px;">
            </el-input>
          </el-form-item>
          <el-form-item>
            <el-button type="primary" @click="addStaff">
              <i class="fa-solid fa-plus"></i> æ–°å¢å“¡å·¥
            </el-button>
          </el-form-item>
        </el-form>
      </div>
    </div>

    <!-- å¿«é€Ÿæ–°å¢å·¥ä½œé …ç›® -->
    <div class="card mb-20">
      <div class="card-header">
        <i class="fa-solid fa-list"></i> å·¥ä½œé …ç›®ç®¡ç†
      </div>
      <div class="card-body">
        <el-form :inline="true" @submit.prevent="addTaskType">
          <el-form-item label="å·¥ä½œé …ç›®">
            <el-input 
              v-model="newTaskType"
              placeholder="è¼¸å…¥å·¥ä½œåç¨±"
              style="width: 200px;">
            </el-input>
          </el-form-item>
          <el-form-item>
            <el-button type="primary" @click="addTaskType">
              <i class="fa-solid fa-plus"></i> æ–°å¢é …ç›®
            </el-button>
          </el-form-item>
        </el-form>

        <div style="margin-top: 12px;" v-if="taskList.length > 0">
          <el-tag 
            v-for="(task, index) in taskList" 
            :key="task"
            closable
            @close="removeTaskType(index)"
            style="margin: 4px;">
            {{ task }}
          </el-tag>
        </div>
        <div v-else style="color: #909399; font-size: 14px; margin-top: 8px;">
          å°šç„¡å·¥ä½œé …ç›®ï¼Œè«‹å…ˆæ–°å¢
        </div>
      </div>
    </div>

    <!-- å“¡å·¥åˆ—è¡¨ -->
    <div class="staff-grid">
      <div class="staff-card" v-for="(staff, staffIndex) in staffData" :key="staff.name">
        <!-- å“¡å·¥å¡ç‰‡é ­éƒ¨ -->
        <div class="staff-header">
          <div class="staff-info">
            <div class="staff-avatar">
              <i class="fa-solid fa-user"></i>
            </div>
            <div>
              <div class="staff-name">{{ staff.name }}</div>
              <div class="staff-meta">
                <span class="badge info">
                  <i class="fa-solid fa-tasks"></i>
                  {{ staff.tasks.length }} é …ä»»å‹™
                </span>
                <span class="badge success">
                  <i class="fa-solid fa-check"></i>
                  å®Œæˆ {{ staffTotalCount(staff) }} æ¬¡
                </span>
              </div>
            </div>
          </div>
          <el-button 
            type="danger" 
            size="small" 
            text
            @click="removeStaff(staffIndex)">
            <i class="fa-solid fa-trash"></i>
          </el-button>
        </div>

        <!-- è–ªè³‡è¨­å®šå€ -->
        <div class="salary-section">
          <div class="section-header">
            <i class="fa-solid fa-sack-dollar"></i>
            <strong>è–ªè³‡è¨­å®š</strong>
          </div>

          <div class="salary-config">
            <el-select 
              v-model="staff.salaryType" 
              placeholder="é¸æ“‡è–ªè³‡é¡å‹" 
              size="small" 
              style="width: 120px;">
              <el-option label="æœˆè–ªåˆ¶" value="monthly">
                <i class="fa-solid fa-calendar"></i> æœˆè–ªåˆ¶
              </el-option>
              <el-option label="æ—¥è–ªåˆ¶" value="daily">
                <i class="fa-solid fa-calendar-day"></i> æ—¥è–ªåˆ¶
              </el-option>
              <el-option label="æ™‚è–ªåˆ¶" value="hourly">
                <i class="fa-solid fa-clock"></i> æ™‚è–ªåˆ¶
              </el-option>
            </el-select>

            <!-- æœˆè–ª -->
            <div v-if="staff.salaryType === 'monthly'" class="salary-calculator">
              <div class="calc-row">
                <span class="calc-label">æ¯æœˆè–ªè³‡</span>
                <el-input-number 
                  v-model="staff.baseSalary" 
                  :min="0" 
                  :step="1000"
                  size="small"
                  style="width: 140px;" />
                <span class="calc-unit">å…ƒ</span>
              </div>
              <div class="calc-row">
                <span class="calc-label">è¨ˆç®—æœˆæ•¸</span>
                <el-input-number 
                  v-model="staff.monthCount" 
                  :min="1" 
                  :max="12"
                  size="small"
                  style="width: 100px;" />
                <span class="calc-unit">å€‹æœˆ</span>
              </div>
              <div class="salary-result">
                <span>ç¸½è–ªè³‡</span>
                <strong>NT$ {{ ((staff.baseSalary || 0) * (staff.monthCount || 1)).toLocaleString() }}</strong>
              </div>
            </div>

            <!-- æ—¥è–ª -->
            <div v-if="staff.salaryType === 'daily'" class="salary-calculator">
              <div class="calc-row">
                <span class="calc-label">æ¯æ—¥è–ªè³‡</span>
                <el-input-number 
                  v-model="staff.baseSalary" 
                  :min="0" 
                  :step="100"
                  size="small"
                  style="width: 140px;" />
                <span class="calc-unit">å…ƒ</span>
              </div>
              <div class="calc-row">
                <span class="calc-label">å·¥ä½œå¤©æ•¸</span>
                <el-input-number 
                  v-model="staff.dayCount" 
                  :min="1" 
                  :max="31"
                  size="small"
                  style="width: 100px;" />
                <span class="calc-unit">å¤©</span>
              </div>
              <div class="salary-result">
                <span>ç¸½è–ªè³‡</span>
                <strong>NT$ {{ ((staff.baseSalary || 0) * (staff.dayCount || 1)).toLocaleString() }}</strong>
              </div>
            </div>

            <!-- æ™‚è–ª -->
            <div v-if="staff.salaryType === 'hourly'" class="salary-calculator">
              <div class="calc-row">
                <span class="calc-label">æ™‚è–ª</span>
                <el-input-number 
                  v-model="staff.baseSalary" 
                  :min="0" 
                  :step="10"
                  size="small"
                  style="width: 140px;" />
                <span class="calc-unit">å…ƒ</span>
              </div>
              <div class="calc-row">
                <span class="calc-label">å·¥ä½œæ™‚æ•¸</span>
                <el-input-number 
                  v-model="staff.hourCount" 
                  :min="1" 
                  :max="744"
                  size="small"
                  style="width: 100px;" />
                <span class="calc-unit">å°æ™‚</span>
              </div>
              <div class="salary-result">
                <span>ç¸½è–ªè³‡</span>
                <strong>NT$ {{ ((staff.baseSalary || 0) * (staff.hourCount || 1)).toLocaleString() }}</strong>
              </div>
            </div>
          </div>
        </div>

        <!-- ä»»å‹™åˆ—è¡¨ -->
        <div class="task-section">
          <div class="section-header">
            <i class="fa-solid fa-clipboard-list"></i>
            <strong>å·¥ä½œè¨˜éŒ„</strong>
          </div>
          
          <div v-if="staff.tasks.length === 0" class="empty-state" style="padding: 30px 20px;">
            <i class="fa-solid fa-inbox"></i>
            <p>å°šç„¡å·¥ä½œè¨˜éŒ„</p>
          </div>

          <div v-else class="task-list">
            <div class="task-item" v-for="(task, taskIndex) in staff.tasks" :key="taskIndex">
              <div class="task-main">
                <el-select 
                  v-model="task.name"
                  placeholder="é¸æ“‡å·¥ä½œé …ç›®"
                  size="small"
                  style="flex: 1;">
                  <el-option 
                    v-for="item in taskList"
                    :key="item"
                    :label="item"
                    :value="item">
                  </el-option>
                </el-select>
                <el-input-number 
                  v-model="task.count" 
                  :min="0"
                  size="small"
                  style="width: 100px;">
                </el-input-number>
                <span class="task-unit">æ¬¡</span>
              </div>
              <el-button 
                type="danger" 
                size="small" 
                text
                @click="removeTask(staff, taskIndex)">
                <i class="fa-solid fa-times"></i>
              </el-button>
            </div>
          </div>
        </div>

        <!-- æ–°å¢ä»»å‹™å€ -->
        <div class="add-task-section">
          <el-form :inline="true" @submit.prevent="addTask(staff)">
            <el-form-item>
              <el-select 
                v-model="newTaskName[staff.name]" 
                placeholder="é¸æ“‡å·¥ä½œé …ç›®"
                size="small"
                style="width: 180px;">
                <el-option 
                  v-for="task in taskList"
                  :key="task"
                  :label="task"
                  :value="task">
                </el-option>
              </el-select>
            </el-form-item>
            <el-form-item>
              <el-input-number 
                v-model="newTaskCount[staff.name]" 
                :min="1"
                placeholder="æ¬¡æ•¸"
                size="small"
                style="width: 100px;">
              </el-input-number>
            </el-form-item>
            <el-form-item>
              <el-button 
                type="primary" 
                size="small"
                @click="addTask(staff)">
                <i class="fa-solid fa-plus"></i> æ–°å¢
              </el-button>
            </el-form-item>
          </el-form>
        </div>
      </div>
    </div>

    <!-- å¦‚æœæ²’æœ‰å“¡å·¥ -->
    <div v-if="staffData.length === 0" class="empty-state">
      <i class="fa-solid fa-users-slash"></i>
      <h3>å°šç„¡å“¡å·¥è³‡æ–™</h3>
      <p>è«‹ä½¿ç”¨ä¸Šæ–¹è¡¨å–®æ–°å¢ç¬¬ä¸€ä½å“¡å·¥</p>
    </div>
  </div>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://unpkg.com/element-plus"></script>
<script>
const { createApp, reactive, computed, ref } = Vue

createApp({
  setup() {
    const staffData = reactive([
      { 
        name: 'é˜¿å®', 
        salaryType: 'hourly',
        baseSalary: 200,
        hourCount: 160,
        dayCount: 0,
        monthCount: 0,
        tasks: [ 
          { name:'æ›æ©Ÿæ²¹', count: 15 }, 
          { name:'ç…è»Šçš®æ›´æ›', count: 8 },
          { name:'è¼ªèƒæ›´æ›', count: 5 }
        ]
      },
      { 
        name: 'é˜¿å¼·', 
        salaryType: 'daily',
        baseSalary: 1200,
        dayCount: 22,
        hourCount: 0,
        monthCount: 0,
        tasks: [ 
          { name:'å¼•æ“æª¢ä¿®', count: 12 },
          { name:'é›»ç³»ç¶­ä¿®', count: 6 }
        ]
      },
      { 
        name: 'é˜¿è³¢', 
        salaryType: 'monthly',
        baseSalary: 36000,
        monthCount: 1,
        dayCount: 0,
        hourCount: 0,
        tasks: [
          { name:'æ›æ©Ÿæ²¹', count: 10 },
          { name:'å®šæœŸä¿é¤Š', count: 7 }
        ]
      },
    ])

    const newTaskName = reactive({})
    const newTaskCount = reactive({})
    const newStaffName = ref('')
    const newTaskType = ref('')
    
    const taskList = reactive([
      'æ›æ©Ÿæ²¹',
      'ç…è»Šçš®æ›´æ›',
      'è¼ªèƒæ›´æ›',
      'å¼•æ“æª¢ä¿®',
      'é›»ç³»ç¶­ä¿®',
      'å®šæœŸä¿é¤Š'
    ])

    // è¨ˆç®—ç¸½è–ªè³‡
    const totalSalary = computed(() => {
      return staffData.reduce((sum, staff) => {
        let salary = 0
        switch (staff.salaryType) {
          case 'monthly':
            salary = (staff.baseSalary || 0) * (staff.monthCount || 1)
            break
          case 'daily':
            salary = (staff.baseSalary || 0) * (staff.dayCount || 1)
            break
          case 'hourly':
            salary = (staff.baseSalary || 0) * (staff.hourCount || 1)
            break
        }
        return sum + salary
      }, 0)
    })

    // è¨ˆç®—ç¸½å®Œæˆä»»å‹™æ•¸
    const totalTasks = computed(() => {
      return staffData.reduce((sum, staff) => {
        return sum + staff.tasks.reduce((taskSum, task) => taskSum + task.count, 0)
      }, 0)
    })

    // è¨ˆç®—è¡¨ç¾æœ€ä½³å“¡å·¥
    const topPerformer = computed(() => {
      if (staffData.length === 0) return '-'
      let maxCount = 0
      let topStaff = staffData[0].name
      
      staffData.forEach(staff => {
        const count = staff.tasks.reduce((sum, task) => sum + task.count, 0)
        if (count > maxCount) {
          maxCount = count
          topStaff = staff.name
        }
      })
      
      return topStaff
    })

    // è¨ˆç®—å–®å€‹å“¡å·¥ç¸½å®Œæˆæ¬¡æ•¸
    const staffTotalCount = (staff) => {
      return staff.tasks.reduce((sum, task) => sum + task.count, 0)
    }

    // æ–°å¢å·¥ä½œé …ç›®
    const addTaskType = () => {
      const name = newTaskType.value.trim()
      if (!name) {
        ElementPlus.ElMessage.warning('è«‹è¼¸å…¥é …ç›®åç¨±')
        return
      }
      if (taskList.includes(name)) {
        ElementPlus.ElMessage.warning('æ­¤é …ç›®å·²å­˜åœ¨')
        return
      }
      taskList.push(name)
      newTaskType.value = ''
      ElementPlus.ElMessage.success('æ–°å¢å·¥ä½œé …ç›®æˆåŠŸ')
    }

    const removeTaskType = (index) => {
      const taskName = taskList[index]
      // æª¢æŸ¥æ˜¯å¦æœ‰å“¡å·¥ä½¿ç”¨æ­¤é …ç›®
      const isUsed = staffData.some(staff => 
        staff.tasks.some(task => task.name === taskName)
      )
      
      if (isUsed) {
        ElementPlus.ElMessage.warning('æ­¤é …ç›®æ­£åœ¨ä½¿ç”¨ä¸­ï¼Œç„¡æ³•åˆªé™¤')
        return
      }
      
      ElementPlus.ElMessageBox.confirm(
        `ç¢ºå®šè¦åˆªé™¤ã€Œ${taskName}ã€å—ï¼Ÿ`,
        'ç¢ºèªåˆªé™¤',
        {
          confirmButtonText: 'ç¢ºå®š',
          cancelButtonText: 'å–æ¶ˆ',
          type: 'warning',
        }
      ).then(() => {
        taskList.splice(index, 1)
        ElementPlus.ElMessage.success('å·²åˆªé™¤å·¥ä½œé …ç›®')
      }).catch(() => {})
    }

    // æ–°å¢å“¡å·¥
    const addStaff = () => {
      const name = newStaffName.value.trim()
      if (!name) {
        ElementPlus.ElMessage.warning('è«‹è¼¸å…¥å“¡å·¥å§“å')
        return
      }
      
      if (staffData.some(s => s.name === name)) {
        ElementPlus.ElMessage.warning('è©²å“¡å·¥å·²å­˜åœ¨')
        return
      }
      
      staffData.push({ 
        name, 
        tasks: [],
        salaryType: 'monthly',
        baseSalary: 0,
        monthCount: 1,
        dayCount: 1,
        hourCount: 1
      })
      newStaffName.value = ''
      ElementPlus.ElMessage.success('æ–°å¢å“¡å·¥æˆåŠŸ')
    }

    // åˆªé™¤å“¡å·¥
    const removeStaff = (index) => {
      ElementPlus.ElMessageBox.confirm(
        `ç¢ºå®šè¦åˆªé™¤ã€Œ${staffData[index].name}ã€å—ï¼Ÿæ‰€æœ‰å·¥ä½œè¨˜éŒ„å’Œè–ªè³‡è¨­å®šä¹Ÿæœƒè¢«åˆªé™¤ã€‚`,
        'ç¢ºèªåˆªé™¤',
        {
          confirmButtonText: 'ç¢ºå®š',
          cancelButtonText: 'å–æ¶ˆ',
          type: 'warning',
        }
      ).then(() => {
        staffData.splice(index, 1)
        ElementPlus.ElMessage.success('å·²åˆªé™¤å“¡å·¥')
      }).catch(() => {})
    }

    // æ–°å¢ä»»å‹™
    const addTask = (staff) => {
      const name = newTaskName[staff.name]?.trim()
      const count = newTaskCount[staff.name] || 1
      
      if (!name) {
        ElementPlus.ElMessage.warning('è«‹é¸æ“‡å·¥ä½œé …ç›®')
        return
      }
      
      staff.tasks.push({ name, count })
      newTaskName[staff.name] = ''
      newTaskCount[staff.name] = 1
      ElementPlus.ElMessage.success('æ–°å¢å·¥ä½œæˆåŠŸ')
    }

    // åˆªé™¤ä»»å‹™
    const removeTask = (staff, index) => {
      staff.tasks.splice(index, 1)
      ElementPlus.ElMessage.success('å·²åˆªé™¤å·¥ä½œ')
    }

    return { 
      staffData, 
      newTaskName, 
      newTaskCount, 
      newStaffName,
      totalTasks,
      totalSalary,
      topPerformer,
      staffTotalCount,
      addStaff,
      removeStaff,
      addTask, 
      removeTask,
      taskList,
      newTaskType,
      addTaskType,
      removeTaskType
    }
  }
}).use(ElementPlus).mount('#app')
</script>

<style>
/* å“¡å·¥ç¶²æ ¼ä½ˆå±€ */
.staff-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

/* å“¡å·¥å¡ç‰‡ */
.staff-card {
  background: white;
  border: 1px solid #e4e7ed;
  border-radius: 8px;
  overflow: hidden;
  transition: all 0.3s;
}

.staff-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
}

/* å“¡å·¥é ­éƒ¨ */
.staff-header {
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.staff-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.staff-avatar {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
}

.staff-name {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 6px;
}

.staff-meta {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.staff-meta .badge {
  background: rgba(255, 255, 255, 0.25);
  color: white;
  border: none;
}

/* å€å¡Šæ¨™é¡Œ */
.section-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: #606266;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid #e4e7ed;
}

.section-header i {
  color: #409EFF;
}

/* è–ªè³‡å€åŸŸ */
.salary-section {
  padding: 20px;
  background: #f8f9fa;
  border-bottom: 1px solid #e4e7ed;
}

.salary-config {
  margin-top: 12px;
}

.salary-calculator {
  margin-top: 12px;
  padding: 16px;
  background: white;
  border-radius: 6px;
  border: 1px solid #e4e7ed;
}

.calc-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}

.calc-row:last-of-type {
  margin-bottom: 0;
}

.calc-label {
  font-size: 14px;
  color: #606266;
  min-width: 80px;
}

.calc-unit {
  font-size: 14px;
  color: #909399;
}

.salary-result {
  margin-top: 16px;
  padding-top: 16px;
  border-top: 2px dashed #e4e7ed;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 16px;
}

.salary-result span {
  color: #606266;
}

.salary-result strong {
  color: #409EFF;
  font-size: 20px;
}

/* ä»»å‹™å€åŸŸ */
.task-section {
  padding: 20px;
  min-height: 120px;
}

.task-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.task-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px;
  background: #f8f9fa;
  border-radius: 6px;
  border: 1px solid #e4e7ed;
}

.task-main {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 8px;
}

.task-unit {
  font-size: 13px;
  color: #909399;
  white-space: nowrap;
}

/* æ–°å¢ä»»å‹™å€ */
.add-task-section {
  padding: 16px 20px;
  background: #f5f7fa;
  border-top: 1px solid #e4e7ed;
}

.add-task-section .el-form {
  margin: 0;
}

.add-task-section .el-form-item {
  margin-bottom: 0;
}

/* éŸ¿æ‡‰å¼ */
@media (max-width: 768px) {
  .staff-grid {
    grid-template-columns: 1fr;
  }

  .calc-row {
    flex-wrap: wrap;
  }

  .calc-label {
    width: 100%;
  }

  .add-task-section .el-form {
    display: block !important;
  }

  .add-task-section .el-form-item {
    display: block;
    margin-bottom: 12px;
  }

  .add-task-section .el-form-item:last-child {
    margin-bottom: 0;
  }

  .add-task-section .el-input,
  .add-task-section .el-input-number,
  .add-task-section .el-select {
    width: 100% !important;
  }

  .task-main {
    flex-wrap: wrap;
  }
}
</style>
</body>
</html>